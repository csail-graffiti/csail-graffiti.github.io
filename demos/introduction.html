<GraffitiQuery
    v-slot="{ results: waves, poll }"
    :channels="[ 'uri:graffiti.garden' ]"
    :pods="[ 'https://pod.graffiti.garden' ]"
    :query="{
        properties: {
            value: {
                properties: {
                    type: { enum: ['Wave'] }
                },
                required: ['type']
            }
        }
    }"
>
    <template v-if="$graffitiSessionInfo.isSessionReady">
        <button
            v-if="!waves.some(wave => wave.webId === $graffitiSessionInfo.webId)"
            @click="$graffiti.put({
                value: { type: 'Wave' },
                channels: ['uri:graffiti.garden']
            }) && poll()"
        >
            ğŸ‘‹
        </button>
        <button
            v-else
            class="waving"
            @click="$graffiti.delete(
                waves.filter(wave => wave.webId === $graffitiSessionInfo.webId)[0]
            ) && poll()"
        >
            ğŸ‘‹
        </button>
    </template>
    <template v-else>
        <p>To wave ğŸ‘‹ you need to be logged in.</p>
        <p>Open the session manager below.</p>
    </template>

    <p>{{ waves.length }} people have waved from this page!</p>
</GraffitiQuery>
