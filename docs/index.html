<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Graffiti x Vue</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <base target="_blank">
  <link href="https://unpkg.com/prismjs@1.28.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
  <link href="style.css" rel="stylesheet" />
</head>
<body>

  <header>
    <ul>
      <li>
        <a target="_self" href="/">
          Graffiti Homepage
        </a>
      </li>
      <li>
        <a target="_self" href="https://github.com/digital-graffiti/graffiti-x-vue">
          Graffiti x Vue Github
        </a>
      </li>
    </ul>
  </header>


  <div id="app">
    <nav>
      <h2>
        Graffiti x Vue
      </h2>
      <ul>
        <li>
          <router-link to="/">
            Introduction
          </router-link>
        </li>
        <li>
          <router-link to="/logging-in">
            Logging In
          </router-link>
        </li>
        <li>
          <router-link to="/collections">
            Collections
          </router-link>
        </li>
        <li>
          <router-link to="/identity">
            Identity
          </router-link>
        </li>
        <li>
          <router-link to="/context">
            Context
          </router-link>
        </li>
        <li>
          <router-link to="/access">
            Access Control
          </router-link>
        </li>
        <li>
          <router-link to="/moderation">
            Moderation
          </router-link>
        </li>
        <li>
          <router-link to="/audit">
            Audits
          </router-link>
        </li>
        <li>
          <router-link to="/ordered">
            Ordered Lists
          </router-link>
        </li>
      </ul>
    </nav>

    <main>
      <router-view></router-view>
    </main>
  </div>

  <script src="https://unpkg.com/prismjs@1.28.0/components/prism-core.min.js"></script>
  <script src="https://unpkg.com/prismjs@1.28.0/components/prism-markup.min.js"></script>
  <script src="https://unpkg.com/prismjs@1.28.0/components/prism-clike.min.js"></script>
  <script src="https://unpkg.com/prismjs@1.28.0/components/prism-javascript.min.js"></script>
  <script src="https://unpkg.com/vue@3.2.37/dist/vue.global.prod.js"></script>
  <script src="https://unpkg.com/vue-router@4.0.14/dist/vue-router.global.prod.js"></script>
  <script type="module">
    import Graffiti from 'https://graffiti.garden/graffiti-x-vue/graffiti.js'

    const DisplayCode = {
      props: ['path'],

      data: ()=> ({code: ''}),

      async created() {
        const request = new Request(this.path)
        const response = await fetch(request)
        this.code = await response.text()
      },

      computed: {
        codePretty() {
          return Prism.highlight(this.code, Prism.languages.javascript, 'javascript');
        }
      },

      template: '<pre><code class="language-javascript" v-html="codePretty"></code></pre>'
    }

    Graffiti(Vue).then(graffiti=> {

      function lazyDoc(name, path=null) { return {
        path: path?path:`/${name}`,
        component: async ()=> {
          const docFile = await import(`./text/${name}.js`)
          return docFile.default(graffiti)
        }
      }}

      const Router = VueRouter.createRouter({
        history: VueRouter.createWebHashHistory(),
        routes: [
          lazyDoc('introduction', '/'),
          lazyDoc('logging-in'),
          lazyDoc('collections'),
          lazyDoc('context'),
          lazyDoc('identity'),
          lazyDoc('access'),
          lazyDoc('moderation'),
          lazyDoc('audit'),
          lazyDoc('ordered')
        ],
        scrollBehavior (to, from, savedPosition) {
          return {left: 0, top: 0}
        }
      })

      Vue.createApp()
        .component('DisplayCode', DisplayCode)
        .use(Router)
        .mount('#app')
    })
  </script>
</body>
</html>
